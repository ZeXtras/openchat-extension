\chapter{Manual Upgrade}

This chapter will guide the administrator through the upgrade of the OpenChat.

\section{From 8.7.6}
\subsection{Upgrade the database}
The default OpenChat database schema was created in \verb!latin1\_swedish\_ci!, the administrator MUST convert it to \verb!UTF-8!

To verify the collation of the database run this command:
\begin{verbatim}
# As zimbra
mysql <<\EOF
  SELECT `DEFAULT_COLLATION_NAME`
    FROM information_schema.SCHEMATA
    WHERE SCHEMA_NAME=`chat`;
EOF
\end{verbatim}
If the current collation name is \verb!latin1\_swedish\_ci! migrate the tables running this command:
\begin{verbatim}
# As zimbra
mysql <<\EOF
  ALTER SCHEMA `chat`
    DEFAULT CHARACTER SET `utf8`
    DEFAULT COLLATE `utf8_general_ci`;
  USE `chat`;
  ALTER TABLE `USER`
    CONVERT TO
        CHARACTER SET `utf8`
        COLLATE `utf8_general_ci`;
  ALTER TABLE `RELATIONSHIP`
    CONVERT TO
        CHARACTER SET `utf8`
        COLLATE `utf8_general_ci`;
  ALTER TABLE `EVENTMESSAGE`
    CONVERT TO
        CHARACTER SET `utf8`
        COLLATE `utf8_general_ci`;
EOF
\end{verbatim}
